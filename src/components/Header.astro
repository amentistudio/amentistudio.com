---
import { getFeaturedNews } from "../actions/featured_news";
import "../styles/tailwind.css";
import Button from "./Button.astro";
import PrimaryButton from "./PrimaryButton.astro";

const featuredNews = await getFeaturedNews();
const currentNews = featuredNews[0];
const restNews = featuredNews.slice(1);
---

<header
  id="header"
  class="text-white text-center w-full bg-cover bg-top"
  style=`background-image: url(${currentNews.metadata.main_image.url}); background-size: cover;`
>
  <div class="flex items-center justify-between mx-12 sticky top-6 z-[100]">
    <img src="/images/logo.png" alt="Amenti Studio logo" class="w-[65px]" />
    <nav
      class="flex items-center space-x-20 font-cagliostro px-10 py-2 nav-style border border-[#262626] rounded-full"
    >
      <a href="#news" class="text-gray-400 hover:text-white">News</a>
      <a href="#game" class="text-gray-400 hover:text-white">Game</a>
      <a href="#press-kit" class="text-gray-400 hover:text-white">Press Kit</a>
      <a href="#studio" class="text-gray-400 hover:text-white">Studio</a>
      <a href="#contacts" class="text-gray-400 hover:text-white">Contacts</a>
    </nav>
    <Button href="https://store.steampowered.com/app/2092970/The_Book_of_Aaru/">
      <div class="flex flex-row gap-2 items-center">
        <span class="font-normal text-gray-300">+ Add to wishlist on</span>
        <img src="/images/steam_logo.svg" alt="Steam logo" class="w-6" />
      </div>
    </Button>
  </div>
  <div class="relative h-[700px] overflow-hidden">
    <div class="absolute bottom-[-200px] left-10">
      <img
        src="/images/emily.png"
        alt="Emily the hero of the game"
        class="w-[600px]"
      />
    </div>
    <div
      class="absolute right-[200px] top-[60px] flex flex-col gap-4 justify-center items-center max-w-[400px]"
    >
      <img
        id="news-top-image"
        src={currentNews.metadata.top_image.url}
        alt={currentNews.title}
        class="w-[150px]"
      />
      <h1
        id="news-title"
        class="text-white text-5xl font-arkhip"
        style="background: linear-gradient(192.29deg, #BDAB87 26.47%, #73603F 95.9%, #342812 155.97%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"
      >
        {currentNews.title}
      </h1>
      <p
        id="news-description"
        class="text-gray-300 text-lg font-cagliostro my-4"
      >
        {currentNews.metadata.text}
      </p>
      <div class="flex flex-row gap-4">
        <PrimaryButton
          id="news-cta-button"
          href={currentNews.metadata.cta_url}
          className="w-min"
        >
          <div class="flex flex-row gap-2 items-center">
            <span id="news-cta-title">{currentNews.metadata.cta_title}</span>
            &rarr;
          </div>
        </PrimaryButton>
      </div>
    </div>
  </div>
</header>

<div class="relative" id="news">
  <div class="flex absolute top-[-130px] z-10 w-full gap-10 justify-center">
    {
      restNews.map((news: any, index: number) => (
        <img
          src={news.metadata.main_image.url}
          alt={news.title}
          class="h-[200px] shadow-sm object-cover hover:scale-105 cursor-pointer"
          style="filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.1));"
          data-news-index={index + 1}
        />
      ))
    }
  </div>
</div>

<script define:vars={{ featuredNews }}>
  let currentNewsIndex = 0;

  function updateCurrentNews(index) {
    currentNewsIndex = index;
    const news = featuredNews[index];

    // Update header background
    const header = document.getElementById("header");
    header.style.backgroundImage = `url(${news.metadata.main_image.url})`;

    // Update news content
    const topImage = document.getElementById("news-top-image");
    topImage.src = news.metadata.top_image.url;
    topImage.alt = news.title;

    const title = document.getElementById("news-title");
    title.textContent = news.title;

    const description = document.getElementById("news-description");
    description.textContent = news.metadata.text;

    const ctaButton = document.getElementById("news-cta-button");
    ctaButton.href = news.metadata.cta_url;

    const ctaTitle = document.getElementById("news-cta-title");
    ctaTitle.textContent = news.metadata.cta_title;
  }

  document.querySelectorAll("#news img").forEach((img) => {
    img.addEventListener("click", (event) => {
      const index = parseInt(event.target.getAttribute("data-news-index"));
      updateCurrentNews(index);
    });
  });
</script>

<style>
  .nav-style {
    background: linear-gradient(
      88.87deg,
      rgba(12, 12, 14, 0.5) -31.2%,
      rgba(12, 12, 14, 0.5) 53.03%,
      rgba(12, 12, 14, 0.5) 135.52%
    );
  }
</style>
